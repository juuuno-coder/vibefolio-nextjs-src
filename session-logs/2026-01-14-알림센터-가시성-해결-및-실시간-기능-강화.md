# 세션 로그: 알림 센터 가시성 해결 및 실시간 기능 강화

### 보이지 않던 드롭다운의 미스터리를 풀고, 실시간 소통의 기반을 마련하다.

**작성일:** 2026년 01월 14일
**작성자:** Antigravity (AI Assistant)

---

## 1. 세션 개요 (Context)

오늘의 세션은 Vibefolio 서비스의 사용자 경험(UX)을 한 단계 끌어올리는 데 집중되었습니다. 특히 사용자가 "도저히 안 보인다"고 호소했던 알림 센터(드롭다운)의 가시성 문제를 해결하는 것이 최대 난관이자 핵심 과제였습니다. 더불어 한국어 닉네임 유저의 접근성 문제와 실시간 '좋아요' 동기화 등 디테일한 기능 개선이 이루어졌습니다.

## 2. 주요 문제와 해결 과정 (Narrative)

### 2.1. "왜 알림창이 뜨지 않는가?" - 깊어진 미스터리

사용자는 헤더의 종(Bell) 아이콘을 클릭했을 때 알림 목록이 떠야 한다고 기대했지만, 아무런 반응이 없거나 보이지 않는다고 했습니다.
초기에는 단순한 **CSS `z-index`**나 **`overflow: hidden`** 문제로 판단했습니다. 헤더가 `fixed`되어 있고, 모달이 `absolute`로 뜰 때 부모 요소에 잘리는 현상이 의심되었습니다.

- **1차 시도 (실패):** `z-index`를 99999로 높이고 스타일을 강제했지만 여전히 보이지 않았습니다.
- **2차 시도 (접근 변경):** 아바타 드롭다운 메뉴와의 충돌(이중 포커스 등)을 의심하여, 아바타 메뉴를 클릭 방식에서 **Hover(마우스 오버)** 방식으로 변경했습니다. UX적으로는 개선되었으나, 여전히 알림창은 보이지 않았습니다.
- **3차 시도 (구조 변경):** 직접 구현한 `div` 드롭다운 대신, Radix UI 기반의 `Popover` 컴포넌트를 도입하여 **Portal** 기능을 통해 DOM 계층 구조 문제를 회피하려 했습니다.
- **최종 해결 (Root Cause):** `Popover`조차 뜨지 않는 것을 보고 근본적인 원인을 추적했습니다. 그 결과, **`src/components/ui/button.tsx` 컴포넌트에 `forwardRef`가 누락**되어 있음을 발견했습니다. Radix UI (Shadcn/ui)의 `Trigger` 컴포넌트는 자식 요소(`Button`)의 위치를 계산하기 위해 `ref`가 필수적인데, 이것이 전달되지 않아 작동하지 않았던 것입니다.
  - **조치:** `Button` 컴포넌트를 `React.forwardRef`로 감싸고, `NotificationBell`의 클릭 핸들러 충돌(이중 토글)을 제거하여 완벽하게 해결했습니다.

### 2.2. 한국어 닉네임은 죄가 없다

한글 닉네임을 사용하는 유저(예: "다온")의 프로필 페이지에 접근하면 404 오류가 발생하거나 데이터가 로드되지 않았습니다. URL 인코딩 문제로 판명되었습니다.

- **해결:** `decodeURIComponent`를 사용하여 URL 파라미터를 올바르게 디코딩한 후 DB를 조회하도록 수정했습니다.

### 2.3. 진짜 '실시간'을 향하여

사용자가 프로젝트 모달을 보고 있는 동안, 다른 유저가 '좋아요'를 누르면 숫자가 즉시 바뀌어야 합니다. 기존엔 새로고침이 필요했습니다.

- **해결:** `Supabase Realtime` 채널을 `Like` 테이블의 특정 프로젝트 ID(`project_id`)에 구독시켜, `INSERT`/`DELETE` 이벤트 발생 시 즉시 카운트를 갱신하도록 구현했습니다.

### 2.4. 눈에 띄는 알림 (High Contrast Toast)

실시간 토스트 알림이 배경에 묻혀 잘 보이지 않는다는 피드백이 있었습니다.

- **해결:** 배경색을 짙은 검정(`#18181b`)으로, 텍스트를 흰색으로 변경하고 그림자를 강화하여 어떤 배경에서도 확실히 눈에 띄게(High Visibility) 개선했습니다.

---

## 3. 기술적 구현 요약 (Technical Summary)

### `src/components/ui/button.tsx`

- `forwardRef` 적용: `Radix UI` 및 `Shadcn/ui` 라이브러리와의 호환성 확보. 모든 버튼 기반 트리거(Popover, Dialog, Dropdown)의 오동작 원인 제거.

### `src/components/NotificationBell.tsx`

- **구조 변경:** `DropdownMenu` -> `Popover`로 변경하여 Portal 기반 렌더링 적용 (Overflow 문제 원천 차단).
- **이중 토글 방지:** `Button`의 자체 `onClick` 핸들러를 제거하고 `Popover`의 `open` state 제어에 위임.
- **스타일링:** `z-index: 99999` 강제 적용.

### `src/hooks/useNotifications.ts`

- **Sonner Toast 스타일링:**
  ```typescript
  style: {
    background: '#18181b',
    color: '#fff',
    border: '1px solid #333',
    boxShadow: '...'
  }
  ```

### `src/components/ProjectDetailModalV2.tsx`

- **Real-time Subscription:**
  ```typescript
  const channel = supabase.channel(...)
    .on('postgres_changes', { table: 'Like', filter: ... }, () => fetchLikesCount())
    .subscribe();
  ```

---

## 4. 결론 (Conclusion)

오늘 세션은 "보이지 않는 것에 대한 디버깅"이라는 어려운 과제를 수행했습니다. 단순한 스타일 문제가 아니라, UI 라이브러리의 핵심 메커니즘(`ref` forwarding)이 끊어져 있었다는 것을 발견한 것은 큰 수확입니다. 이 수정은 비단 알림 센터뿐만 아니라 사이트 전반의 인터랙션 안정성을 크게 높였을 것입니다.

Vibefolio는 이제 **실시간으로 숨 쉬고(Realtime Sync), 선명하게 알리며(High Contrast Toast), 막힘없이 반응(Ref Fixed)하는** 서비스로 거듭났습니다.
