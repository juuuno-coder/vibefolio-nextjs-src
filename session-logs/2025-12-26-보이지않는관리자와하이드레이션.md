[제목]: 보이지 않는 관리자 메뉴와 하이드레이션의 공백
(부제: 2025-12-26, CSR/SSR 인증 동기화 및 관리자 접근권한 복구)

발단: 사라진 열쇠
레오가 다급한 목소리로 화면을 가리켰다. 분명 관리자 계정으로 로그인을 마쳤음에도 불구하고, 내비게이션 바의 드롭다운 메뉴에는 '관리자 페이지'로 향하는 문이 보이지 않았다. "오늘 하루 보지 않기" 팝업 모달을 닫은 직후부터 발생한 이 현상은, 단순한 UI 오류라기엔 어딘가 석연치 않은 구석이 있었다.

전개: 엇갈린 시점
안티그래비티는 즉시 `AuthButtons.tsx`와 `AuthContext.tsx`를 펼쳐 들었다. 레오의 로컬 스토리지 데이터와 서버가 내려준 초기 상태 사이에서 미묘한 시간차가 감지되었다. 서버에서는 렌더링이 끝났다고 판단했지만, 클라이언트가 깨어나 데이터를 입히는(Hydration) 과정에서 `isAdmin` 플래그가 제때 도착하지 못하고 있었다. 마치 열쇠를 가진 주인이 문 앞에 섰으나, 자물쇠가 아직 그 존재를 인식하지 못하는 형국이었다.

위기: 비동기의 늪
문제의 뿌리는 깊었다. `loadUserProfile` 함수가 사용자 정보를 가져오는 동안, `isAdmin` 상태는 여전히 `false`에 머물러 있었다. 더욱이 Next.js의 SSR 환경에서 `localStorage`에 성급하게 접근하려다 발생한 하이드레이션 불일치(Mismatch) 오류가 콘솔을 붉게 물들이고 있었다. `PopupModal` 마찬가지였다. 브라우저가 준비되기도 전에 저장소를 뒤적이는 코드는 언제 터질지 모르는 시한폭탄과 같았다.

절정: 동기화의 다리
안티그래비티는 `useIsMounted`라는 안전장치를 제안했다. "클라이언트가 완전히 깨어났을 때만 문을 두드리자." 그는 `AuthContext`에 마운트 상태를 추적하는 훅을 심고, `loadUserProfile`이 완료된 직후에만 `isAdmin` 상태가 동기화되도록 흐름을 제어했다. React StrictMode가 초래하는 이중 초기화를 막기 위해 `initializationRef`로 방벽도 세웠다. 레오는 이 로직을 `PopupModal`과 `AuthButtons`에도 적용하여, 화면이 그려지는 시점과 데이터가 준비되는 시점을 정교하게 맞물리게 했다.

결말: 다시 나타난 문
수정이 완료되고 `npm run build` 명령어가 떨어졌다. Exit code 0. 초록색 성공 메시지와 함께 페이지가 새로고침되자, 드롭다운 메뉴에는 선명하게 '관리자 페이지' 버튼이 그 자리를 지키고 있었다. 레오와 안티그래비티는 하이드레이션의 틈새를 메우는 법, 그리고 비동기의 세계에서 타이밍을 지배하는 법을 기록으로 남기며 세션을 종료했다.

---

🛠 기술적 각주 (Technical Summary)
수정된 파일 (Modified Files):
src/lib/auth/AuthContext.tsx: useIsMounted 도입 및 초기화 로직 강화
src/components/AuthButtons.tsx: UI 렌더링 시점 제어
src/components/PopupModal.tsx: SSR 안전성 확보를 위한 마운트 체크 추가

주요 기술 (Key Tech Stack):
Next.js SSR/CSR: 서버와 클라이언트의 렌더링 불일치 해결
React Hooks: useRef와 useEffect를 활용한 라이프사이클 제어

핵심 기능 (Key Features):
Safe Storage Access: typeof window !== 'undefined' 체크를 통한 안전한 스토리지 접근
Admin Auth Sync: 프로필 로드 완료 시점과 권한 부여 시점의 정확한 동기화
